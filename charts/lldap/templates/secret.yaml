---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "app.fullname" . }}
  labels:
    {{- include "app.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": pre-install
type: Opaque
immutable: true
data:
  LLDAP_JWT_SECRET: {{ randAlphaNum 32 | b64enc | quote }}
  LLDAP_KEY_SEED: {{ randAlphaNum 32 | b64enc | quote }}
  LLDAP_ADMIN_PASSWORD: {{ randAlphaNum 64 | b64enc | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "app.fullname" . }}-bootstrap
  labels:
    {{- include "app.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": post-install
type: Opaque
stringData:
  groups: |-
    {
      "name": "media_admin"
    }
    {
      "name": "media"
    }

  users: |-
    {
      "id": "readonly",
      "email": "readonly@localhost",
      "password": {{ randAlphaNum 64 | quote }},
      "groups": [
        "lldap_strict_readonly"
      ]
    }
    {
      "id": "password_manager",
      "email": "password_manager@localhost",
      "password": {{ randAlphaNum 64 | quote }},
      "groups": [
        "lldap_password_manager"
      ]
    }
    {
      "id": "admin",
      "email": "admin@localhost",
      "password": {{ randAlphaNum 64 | quote }},
      "groups": [
        "lldap_manager"
      ]
    }
